Qpid Dispatch Router Idle AutoLink Scrubber (qdials)
====================================================

This tool monitors the autoLinks on a Qpid Dispatch Router (qdrouterd)
and deletes those autoLink configuration records that are classified
as idle.

The goal is to remove state autoLink configuration entries that
correspond to orphaned queues on a broker.

When qdrouter connects to a broker all autoLink configured for that
broker will activate.  This entails setting up a link to the broker
for each autoLink entry.  AutoLinks with a direction of 'in' create a
link that consumes messages from the broker (inbound link with respect
to the router).  AutoLinks with a direction of 'out' will create links
that send messages to the broker (outbound with respect to the router).

These links are created automatically on broker connect regardless of
whether or not clients exist that want to publish or consume messages
on the broker.

If the broker is configured to instantiate queues on demand then these
autoLink-generated links will cause queues to be created.  These
queues will remain present until the autoLink configuration associated
with the link to the queue is removed.  This means that the queues
will remain present even when there are no clients that use the queue.

This tool can be used to scan for clients that subscribe to the
autoLink queues and delete the corresponding autoLink configuration
records (and associated links) when there are no subscribers present
for the autoLink address.


Algorithm
---------

The following repeats once for every poll cycle:

 * A connection is made to the router.
 * A management query is sent to the router that requests the current
   autoLink configuration records
 * For each autoLink that has a direction of 'in':
   * The router is queried for the status of the address associated
     with the queue generated by the in autolink
   * The total number of subscribers to that queue is obtained
   * If the total number of subscribers is zero:
     * The autoLink entry corresponding to the 'in' entry is saved.
 * The newly created list of 'in' autoLinks is compared to the list of
   autoLinks created from the last poll.
   * The autoLinks that are on both lists are deleted.
 * The new list of autoLinks is saved for the next poll.


Note Well
---------

This tool only cleans up the inbound link from the broker (queue
subscriber).  The outbound link from the router to the broker (queue
publisher) is left untouched.
